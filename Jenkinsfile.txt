pipeline {
    agent any

    stages {
        stage('Actualizar Jira') {
            steps {
                script {
                    // Credenciales de Jira
                    def jiraUsername = 'Claudia Salg√°n'
                    def jiraPassword = 'p3c&U9pLdL9M'
                    def jiraUrl = 'https://bcba-testing-factory.atlassian.net'

                    // ID del proyecto y la tarjeta en Jira
                    def projectId = '10027'
                    def issueId = '13211'

                    // Actualizar estado de la tarjeta
                    def response = httpRequest url: "${jiraUrl}/rest/api/2/issue/${issueId}/transitions",
                            httpMode: 'POST',
                            authentication: 'Basic',
                            username: jiraUsername,
                            password: jiraPassword,
                            requestBody: '{"transition":{"id":"10034"}}' // ID del estado "En Desarrollo" por ejemplo

                    // Agregar comentario
                    def comment = 'Desplegado en Jenkins'
                    response = httpRequest url: "${jiraUrl}/rest/api/2/issue/${issueId}/comment",
                            httpMode: 'POST',
                            authentication: 'Basic',
                            username: jiraUsername,
                            password: jiraPassword,
                            requestBody: '{"body":"' + comment + '"}'

                    // Agregar etiqueta
                    def label = 'desplegado-en-jenkins'
                    response = httpRequest url: "${jiraUrl}/rest/api/2/issue/${issueId}/labels",
                            httpMode: 'POST',
                            authentication: 'Basic',
                            username: jiraUsername,
                            password: jiraPassword,
                            requestBody: '{"labels":["' + label + '"]}'
                }
            }
        }
    }
}